(window.webpackJsonp=window.webpackJsonp||[]).push([[191],{508:function(s,n,e){"use strict";e.r(n);var a=e(17),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"构造函数与new命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构造函数与new命令"}},[s._v("#")]),s._v(" 构造函数与new命令")]),s._v(" "),e("h2",{attrs:{id:"构造函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构造函数"}},[s._v("#")]),s._v(" 构造函数")]),s._v(" "),e("blockquote",[e("p",[s._v("JavaScript 语言使用构造函数（constructor）作为对象的模板。所谓”构造函数”，就是专门用来生成实例对象的函数。它就是对象的模板，描述实例对象的基本结构。一个构造函数，可以生成多个实例对象，这些实例对象都有相同的结构。")])]),s._v(" "),e("p",[s._v("构造函数就是一个普通的函数，但是有自己的特征和用法。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("var Vehicle = function () {\n  this.price = 1000;\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("上面代码中，Vehicle就是构造函数。为了与普通函数区别，构造函数名字的第一个字母通常大写。")]),s._v(" "),e("p",[s._v("构造函数的特点有两个。")]),s._v(" "),e("ul",[e("li",[s._v("函数体内部使用了this关键字，代表了所要生成的对象实例。")]),s._v(" "),e("li",[s._v("生成对象的时候，必须使用new命令。")])]),s._v(" "),e("h2",{attrs:{id:"new命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#new命令"}},[s._v("#")]),s._v(" new命令")]),s._v(" "),e("h3",{attrs:{id:"_1-基本用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本用法"}},[s._v("#")]),s._v(" 1. 基本用法")]),s._v(" "),e("p",[s._v("new命令的作用，就是执行构造函数，返回一个实例对象。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("var Vehicle = function () {\n  this.price = 1000;\n};\n\nvar v = new Vehicle();\nv.price // 1000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("使用new命令时，根据需要，构造函数也可以接受参数。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("var Vehicle = function (p) {\n  this.price = p;\n};\n\nvar v = new Vehicle(500);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("如果忘了使用new命令，直接调用构造函数，构造函数就变成了普通函数，并不会生成实例对象。this这时代表全局对象，将造成一些意想不到的结果。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("var Vehicle = function (){\n  this.price = 1000;\n};\n\nvar v = Vehicle();\nv // undefined\nprice // 1000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_2-new命令的原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-new命令的原理"}},[s._v("#")]),s._v(" 2. new命令的原理")]),s._v(" "),e("p",[s._v("使用new命令时，它后面的函数依次执行下面的步骤。")]),s._v(" "),e("ol",[e("li",[s._v("创建一个空对象，作为将要返回的对象实例。")]),s._v(" "),e("li",[s._v("将这个空对象的原型，指向构造函数的prototype属性。")]),s._v(" "),e("li",[s._v("将这个空对象赋值给函数内部的this关键字。")]),s._v(" "),e("li",[s._v("开始执行构造函数内部的代码。")])]),s._v(" "),e("p",[s._v("如果构造函数内部有return语句，而且return后面跟着一个对象，new命令会返回return语句指定的对象；否则，就会不管return语句，返回this对象。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("var Vehicle = function () {\n  this.price = 1000;\n  return 1000;\n};\n\n(new Vehicle()) === 1000\n// false\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("如果return语句返回的是一个跟this无关的新对象，new命令会返回这个新对象，而不是this对象。这一点需要特别引起注意。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("var Vehicle = function (){\n  this.price = 1000;\n  return { price: 2000 };\n};\n\n(new Vehicle()).price\n// 2000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("另一方面，如果对普通函数（内部没有this关键字的函数）使用new命令，则会返回一个空对象。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function getMessage() {\n  return 'this is a message';\n}\n\nvar msg = new getMessage();\n\nmsg // {}\ntypeof msg // \"object\"\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"_3-new-target"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-new-target"}},[s._v("#")]),s._v(" 3. new.target")]),s._v(" "),e("p",[s._v("函数内部可以使用new.target属性。如果当前函数是new命令调用，new.target指向当前函数，否则为undefined。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function f() {\n  console.log(new.target === f);\n}\n\nf() // false\nnew f() // true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("使用这个属性，可以判断函数调用的时候，是否使用new命令。")]),s._v(" "),e("div",{staticClass:"language-obj line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function f() {\n  if (!new.target) {\n    throw new Error('请使用 new 命令调用！');\n  }\n  // ...\n}\n\nf() // Uncaught Error: 请使用 new 命令调用！\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);