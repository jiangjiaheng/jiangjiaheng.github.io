(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{451:function(e,s,n){"use strict";n.r(s);var a=n(17),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"indexeddb-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb-api"}},[e._v("#")]),e._v(" IndexedDB API")]),e._v(" "),n("h2",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[e._v("#")]),e._v(" 概述")]),e._v(" "),n("p",[e._v("随着浏览器的功能不断增强，越来越多的网站开始考虑，将大量数据储存在客户端，这样可以减少从服务器获取数据，直接从本地获取数据。")]),e._v(" "),n("p",[e._v("现有的浏览器数据储存方案，都不适合储存大量数据：Cookie 的大小不超过 4KB，且每次请求都会发送回服务器；LocalStorage 在 2.5MB 到 10MB 之间（各家浏览器不同），而且不提供搜索功能，不能建立自定义的索引。所以，需要一种新的解决方案，这就是 IndexedDB 诞生的背景。")]),e._v(" "),n("p",[e._v("通俗地说，IndexedDB 就是浏览器提供的本地数据库，它可以被网页脚本创建和操作。IndexedDB 允许储存大量数据，提供查找接口，还能建立索引。这些都是 LocalStorage 所不具备的。就数据库类型而言，IndexedDB 不属于关系型数据库（不支持 SQL 查询语句），更接近 NoSQL 数据库。")]),e._v(" "),n("p",[e._v("IndexedDB 具有以下特点。")]),e._v(" "),n("p",[n("strong",[e._v("（1）键值对储存")]),e._v("。 IndexedDB 内部采用对象仓库（object store）存放数据。所有类型的数据都可以直接存入，包括 JavaScript 对象。对象仓库中，数据以“键值对”的形式保存，每一个数据记录都有对应的主键，主键是独一无二的，不能有重复，否则会抛出一个错误。")]),e._v(" "),n("p",[n("strong",[e._v("（2）异步")]),e._v("。 IndexedDB 操作时不会锁死浏览器，用户依然可以进行其他操作，这与 LocalStorage 形成对比，后者的操作是同步的。异步设计是为了防止大量数据的读写，拖慢网页的表现。")]),e._v(" "),n("p",[n("strong",[e._v("（3）支持事务")]),e._v("。 IndexedDB 支持事务（transaction），这意味着一系列操作步骤之中，只要有一步失败，整个事务就都取消，数据库回滚到事务发生之前的状态，不存在只改写一部分数据的情况。")]),e._v(" "),n("p",[n("strong",[e._v("（4）同源限制")]),e._v("。 IndexedDB 受到同源限制，每一个数据库对应创建它的域名。网页只能访问自身域名下的数据库，而不能访问跨域的数据库。")]),e._v(" "),n("p",[n("strong",[e._v("（5）储存空间大")]),e._v("。 IndexedDB 的储存空间比 LocalStorage 大得多，一般来说不少于 250MB，甚至没有上限。")]),e._v(" "),n("p",[n("strong",[e._v("（6）支持二进制储存")]),e._v("。 IndexedDB 不仅可以储存字符串，还可以储存二进制数据（ArrayBuffer 对象和 Blob 对象）。")]),e._v(" "),n("h2",{attrs:{id:"基本概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[e._v("#")]),e._v(" 基本概念")]),e._v(" "),n("p",[e._v("IndexedDB 是一个比较复杂的 API，涉及不少概念。它把不同的实体，抽象成一个个对象接口。学习这个 API，就是学习它的各种对象接口。")]),e._v(" "),n("ul",[n("li",[e._v("数据库：IDBDatabase 对象")]),e._v(" "),n("li",[e._v("对象仓库：IDBObjectStore 对象")]),e._v(" "),n("li",[e._v("索引： IDBIndex 对象")]),e._v(" "),n("li",[e._v("事务： IDBTransaction 对象")]),e._v(" "),n("li",[e._v("操作请求：IDBRequest 对象")]),e._v(" "),n("li",[e._v("指针： IDBCursor 对象")]),e._v(" "),n("li",[e._v("主键集合：IDBKeyRange 对象")])]),e._v(" "),n("p",[e._v("下面是一些主要的概念。")]),e._v(" "),n("h3",{attrs:{id:"_1-数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-数据库"}},[e._v("#")]),e._v(" （1）数据库")]),e._v(" "),n("p",[e._v("数据库是一系列相关数据的容器。每个域名（严格的说，是协议 + 域名 + 端口）都可以新建任意多个数据库。")]),e._v(" "),n("p",[e._v("IndexedDB 数据库有版本的概念。同一个时刻，只能有一个版本的数据库存在。如果要修改数据库结构（新增或删除表、索引或者主键），只能通过升级数据库版本完成。")]),e._v(" "),n("h3",{attrs:{id:"_2-对象仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-对象仓库"}},[e._v("#")]),e._v(" （2）对象仓库")]),e._v(" "),n("p",[e._v("每个数据库包含若干个对象仓库（object store）。它类似于关系型数据库的表格。")]),e._v(" "),n("h3",{attrs:{id:"_3-数据记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-数据记录"}},[e._v("#")]),e._v(" （3）数据记录")]),e._v(" "),n("p",[e._v("对象仓库保存的是数据记录。每条记录类似于关系型数据库的行，但是只有主键和数据体两部分。主键用来建立默认的索引，必须是不同的，否则会报错。主键可以是数据记录里面的一个属性，也可以指定为一个递增的整数编号。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("{ id: 1, text: 'foo' }\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("上面的对象中，id属性可以当作主键。")]),e._v(" "),n("p",[e._v("数据体可以是任意数据类型，不限于对象。")]),e._v(" "),n("h3",{attrs:{id:"_4-索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-索引"}},[e._v("#")]),e._v(" （4）索引")]),e._v(" "),n("p",[e._v("为了加速数据的检索，可以在对象仓库里面，为不同的属性建立索引。")]),e._v(" "),n("h3",{attrs:{id:"_5-事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-事务"}},[e._v("#")]),e._v(" （5）事务")]),e._v(" "),n("p",[e._v("数据记录的读写和删改，都要通过事务完成。事务对象提供error、abort和complete三个事件，用来监听操作结果。")]),e._v(" "),n("h2",{attrs:{id:"操作流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#操作流程"}},[e._v("#")]),e._v(" 操作流程")]),e._v(" "),n("p",[e._v("IndexedDB 数据库的各种操作，一般是按照下面的流程进行的。这个部分只给出简单的代码示例，用于快速上手，详细的各个对象的 API 放在后文介绍。")]),e._v(" "),n("h3",{attrs:{id:"_1-打开数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-打开数据库"}},[e._v("#")]),e._v(" 1. 打开数据库")]),e._v(" "),n("p",[e._v("使用 IndexedDB 的第一步是打开数据库，使用indexedDB.open()方法。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var request = window.indexedDB.open(databaseName, version);\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("这个方法接受两个参数，第一个参数是字符串，表示数据库的名字。如果指定的数据库不存在，就会新建数据库。第二个参数是整数，表示数据库的版本。如果省略，打开已有数据库时，默认为当前版本；新建数据库时，默认为1。")]),e._v(" "),n("p",[e._v("indexedDB.open()方法返回一个 IDBRequest 对象。这个对象通过三种事件error、success、upgradeneeded，处理打开数据库的操作结果。")]),e._v(" "),n("h4",{attrs:{id:"_1-error-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-error-事件"}},[e._v("#")]),e._v(" （1）error 事件")]),e._v(" "),n("p",[e._v("error事件表示打开数据库失败。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("request.onerror = function (event) {\n  console.log('数据库打开报错');\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("h4",{attrs:{id:"_2-success-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-success-事件"}},[e._v("#")]),e._v(" （2）success 事件")]),e._v(" "),n("p",[e._v("success事件表示成功打开数据库。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var db;\n\nrequest.onsuccess = function (event) {\n  db = request.result;\n  console.log('数据库打开成功');\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("这时，通过request对象的result属性拿到数据库对象。")]),e._v(" "),n("h4",{attrs:{id:"_3-upgradeneeded-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-upgradeneeded-事件"}},[e._v("#")]),e._v(" （3）upgradeneeded 事件")]),e._v(" "),n("p",[e._v("如果指定的版本号，大于数据库的实际版本号，就会发生数据库升级事件upgradeneeded。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var db;\n\nrequest.onupgradeneeded = function (event) {\n  db = event.target.result;\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("这时通过事件对象的target.result属性，拿到数据库实例。")]),e._v(" "),n("h3",{attrs:{id:"_2-新建数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-新建数据库"}},[e._v("#")]),e._v(" 2. 新建数据库")]),e._v(" "),n("p",[e._v("新建数据库与打开数据库是同一个操作。如果指定的数据库不存在，就会新建。不同之处在于，后续的操作主要在upgradeneeded事件的监听函数里面完成，因为这时版本从无到有，所以会触发这个事件。")]),e._v(" "),n("p",[e._v("通常，新建数据库以后，第一件事是新建对象仓库（即新建表）。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("request.onupgradeneeded = function(event) {\n  db = event.target.result;\n  var objectStore = db.createObjectStore('person', { keyPath: 'id' });\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("上面代码中，数据库新建成功以后，新增一张叫做person的表格，主键是id。")]),e._v(" "),n("p",[e._v("更好的写法是先判断一下，这张表格是否存在，如果不存在再新建。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("request.onupgradeneeded = function (event) {\n  db = event.target.result;\n  var objectStore;\n  if (!db.objectStoreNames.contains('person')) {\n    objectStore = db.createObjectStore('person', { keyPath: 'id' });\n  }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("p",[e._v("主键（key）是默认建立索引的属性。比如，数据记录是{ id: 1, name: '张三' }，那么id属性可以作为主键。主键也可以指定为下一层对象的属性，比如{ foo: { bar: 'baz' } }的foo.bar也可以指定为主键。")]),e._v(" "),n("p",[e._v("如果数据记录里面没有合适作为主键的属性，那么可以让 IndexedDB 自动生成主键。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var objectStore = db.createObjectStore(\n  'person',\n  { autoIncrement: true }\n);\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("上面代码中，指定主键为一个递增的整数。")]),e._v(" "),n("p",[e._v("新建对象仓库以后，下一步可以新建索引。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("request.onupgradeneeded = function(event) {\n  db = event.target.result;\n  var objectStore = db.createObjectStore('person', { keyPath: 'id' });\n  objectStore.createIndex('name', 'name', { unique: false });\n  objectStore.createIndex('email', 'email', { unique: true });\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("上面代码中，IDBObject.createIndex()的三个参数分别为索引名称、索引所在的属性、配置对象（说明该属性是否包含重复的值）。")]),e._v(" "),n("h3",{attrs:{id:"_3-新增数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-新增数据"}},[e._v("#")]),e._v(" 3. 新增数据")]),e._v(" "),n("p",[e._v("新增数据指的是向对象仓库写入数据记录。这需要通过事务完成。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function add() {\n  var request = db.transaction(['person'], 'readwrite')\n    .objectStore('person')\n    .add({ id: 1, name: '张三', age: 24, email: 'zhangsan@example.com' });\n\n  request.onsuccess = function (event) {\n    console.log('数据写入成功');\n  };\n\n  request.onerror = function (event) {\n    console.log('数据写入失败');\n  }\n}\n\nadd();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br")])]),n("p",[e._v("上面代码中，写入数据需要新建一个事务。新建时必须指定表格名称和操作模式（“只读”或“读写”）。新建事务以后，通过IDBTransaction.objectStore(name)方法，拿到 IDBObjectStore 对象，再通过表格对象的add()方法，向表格写入一条记录。")]),e._v(" "),n("p",[e._v("写入操作是一个异步操作，通过监听连接对象的success事件和error事件，了解是否写入成功。")]),e._v(" "),n("h3",{attrs:{id:"_4-读取数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-读取数据"}},[e._v("#")]),e._v(" 4. 读取数据")]),e._v(" "),n("p",[e._v("读取数据也是通过事务完成。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function read() {\n   var transaction = db.transaction(['person']);\n   var objectStore = transaction.objectStore('person');\n   var request = objectStore.get(1);\n\n   request.onerror = function(event) {\n     console.log('事务失败');\n   };\n\n   request.onsuccess = function( event) {\n      if (request.result) {\n        console.log('Name: ' + request.result.name);\n        console.log('Age: ' + request.result.age);\n        console.log('Email: ' + request.result.email);\n      } else {\n        console.log('未获得数据记录');\n      }\n   };\n}\n\nread();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br")])]),n("p",[e._v("上面代码中，objectStore.get()方法用于读取数据，参数是主键的值。")]),e._v(" "),n("h3",{attrs:{id:"_5-遍历数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-遍历数据"}},[e._v("#")]),e._v(" 5. 遍历数据")]),e._v(" "),n("p",[e._v("遍历数据表格的所有记录，要使用指针对象 IDBCursor。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function readAll() {\n  var objectStore = db.transaction('person').objectStore('person');\n\n   objectStore.openCursor().onsuccess = function (event) {\n     var cursor = event.target.result;\n\n     if (cursor) {\n       console.log('Id: ' + cursor.key);\n       console.log('Name: ' + cursor.value.name);\n       console.log('Age: ' + cursor.value.age);\n       console.log('Email: ' + cursor.value.email);\n       cursor.continue();\n    } else {\n      console.log('没有更多数据了！');\n    }\n  };\n}\n\nreadAll();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br")])]),n("p",[e._v("上面代码中，新建指针对象的openCursor()方法是一个异步操作，所以要监听success事件。")]),e._v(" "),n("h3",{attrs:{id:"_6-更新数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-更新数据"}},[e._v("#")]),e._v(" 6. 更新数据")]),e._v(" "),n("p",[e._v("更新数据要使用IDBObject.put()方法。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function update() {\n  var request = db.transaction(['person'], 'readwrite')\n    .objectStore('person')\n    .put({ id: 1, name: '李四', age: 35, email: 'lisi@example.com' });\n\n  request.onsuccess = function (event) {\n    console.log('数据更新成功');\n  };\n\n  request.onerror = function (event) {\n    console.log('数据更新失败');\n  }\n}\n\nupdate();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br")])]),n("p",[e._v("上面代码中，put()方法自动更新了主键为1的记录。")]),e._v(" "),n("h3",{attrs:{id:"_7-删除数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-删除数据"}},[e._v("#")]),e._v(" 7. 删除数据")]),e._v(" "),n("p",[e._v("IDBObjectStore.delete()方法用于删除记录。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function remove() {\n  var request = db.transaction(['person'], 'readwrite')\n    .objectStore('person')\n    .delete(1);\n\n  request.onsuccess = function (event) {\n    console.log('数据删除成功');\n  };\n}\n\nremove();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h3",{attrs:{id:"_8-使用索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-使用索引"}},[e._v("#")]),e._v(" 8. 使用索引")]),e._v(" "),n("p",[e._v("索引的意义在于，可以让你搜索任意字段，也就是说从任意字段拿到数据记录。如果不建立索引，默认只能搜索主键（即从主键取值）。")]),e._v(" "),n("p",[e._v("假定新建表格的时候，对name字段建立了索引。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.createIndex('name', 'name', { unique: false });\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("现在，就可以从name找到对应的数据记录了。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var transaction = db.transaction(['person'], 'readonly');\nvar store = transaction.objectStore('person');\nvar index = store.index('name');\nvar request = index.get('李四');\n\nrequest.onsuccess = function (e) {\n  var result = e.target.result;\n  if (result) {\n    // ...\n  } else {\n    // ...\n  }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("h2",{attrs:{id:"indexeddb-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb-对象"}},[e._v("#")]),e._v(" indexedDB 对象")]),e._v(" "),n("p",[e._v("浏览器原生提供indexedDB对象，作为开发者的操作接口。")]),e._v(" "),n("h3",{attrs:{id:"_1-indexeddb-open"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-indexeddb-open"}},[e._v("#")]),e._v(" 1. indexedDB.open()")]),e._v(" "),n("p",[e._v("indexedDB.open()方法用于打开数据库。这是一个异步操作，但是会立刻返回一个 IDBOpenDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var openRequest = window.indexedDB.open('test', 1);\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("上面代码表示，打开一个名为test、版本为1的数据库。如果该数据库不存在，则会新建该数据库。")]),e._v(" "),n("p",[e._v("open()方法的第一个参数是数据库名称，格式为字符串，不可省略；第二个参数是数据库版本，是一个大于0的正整数（0将报错），如果该参数大于当前版本，会触发数据库升级。第二个参数可省略，如果数据库已存在，将打开当前版本的数据库；如果数据库不存在，将创建该版本的数据库，默认版本为1。")]),e._v(" "),n("p",[e._v("打开数据库是异步操作，通过各种事件通知客户端。下面是有可能触发的4种事件。")]),e._v(" "),n("ul",[n("li",[e._v("success：打开成功。")]),e._v(" "),n("li",[e._v("error：打开失败。")]),e._v(" "),n("li",[e._v("upgradeneeded：第一次打开该数据库，或者数据库版本发生变化。")]),e._v(" "),n("li",[e._v("blocked：上一次的数据库连接还未关闭。")])]),e._v(" "),n("p",[e._v("第一次打开数据库时，会先触发upgradeneeded事件，然后触发success事件。")]),e._v(" "),n("p",[e._v("根据不同的需要，对上面4种事件监听函数。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var openRequest = indexedDB.open('test', 1);\nvar db;\n\nopenRequest.onupgradeneeded = function (e) {\n  console.log('Upgrading...');\n}\n\nopenRequest.onsuccess = function (e) {\n  console.log('Success!');\n  db = openRequest.result;\n}\n\nopenRequest.onerror = function (e) {\n  console.log('Error');\n  console.log(e);\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br")])]),n("p",[e._v("上面代码有两个地方需要注意。首先，open()方法返回的是一个对象（IDBOpenDBRequest），监听函数就定义在这个对象上面。其次，success事件发生后，从openRequest.result属性可以拿到已经打开的IndexedDB数据库对象。")]),e._v(" "),n("h3",{attrs:{id:"_2-indexeddb-deletedatabase"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-indexeddb-deletedatabase"}},[e._v("#")]),e._v(" 2. indexedDB.deleteDatabase()")]),e._v(" "),n("p",[e._v("indexedDB.deleteDatabase()方法用于删除一个数据库，参数为数据库的名字。它会立刻返回一个IDBOpenDBRequest对象，然后对数据库执行异步删除。删除操作的结果会通过事件通知，IDBOpenDBRequest对象可以监听以下事件。")]),e._v(" "),n("ul",[n("li",[e._v("success：删除成功")]),e._v(" "),n("li",[e._v("error：删除报错")])]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var DBDeleteRequest = window.indexedDB.deleteDatabase('demo');\n\nDBDeleteRequest.onerror = function (event) {\n  console.log('Error');\n};\n\nDBDeleteRequest.onsuccess = function (event) {\n  console.log('success');\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br")])]),n("p",[e._v("调用deleteDatabase()方法以后，当前数据库的其他已经打开的连接都会接收到versionchange事件。")]),e._v(" "),n("p",[e._v("注意，删除不存在的数据库并不会报错。")]),e._v(" "),n("h3",{attrs:{id:"_3-indexeddb-cmp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-indexeddb-cmp"}},[e._v("#")]),e._v(" 3. indexedDB.cmp()")]),e._v(" "),n("p",[e._v("indexedDB.cmp()方法比较两个值是否为 indexedDB 的相同的主键。它返回一个整数，表示比较的结果：0表示相同，1表示第一个主键大于第二个主键，-1表示第一个主键小于第二个主键。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("window.indexedDB.cmp(1, 2) // -1\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("注意，这个方法不能用来比较任意的 JavaScript 值。如果参数是布尔值或对象，它会报错。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("window.indexedDB.cmp(1, true) // 报错\nwindow.indexedDB.cmp({}, {}) // 报错\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("h2",{attrs:{id:"idbrequest-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#idbrequest-对象"}},[e._v("#")]),e._v(" IDBRequest 对象")]),e._v(" "),n("p",[e._v("IDBRequest 对象表示打开的数据库连接，indexedDB.open()方法和indexedDB.deleteDatabase()方法会返回这个对象。数据库的操作都是通过这个对象完成的。")]),e._v(" "),n("p",[e._v("这个对象的所有操作都是异步操作，要通过readyState属性判断是否完成，如果为pending就表示操作正在进行，如果为done就表示操作完成，可能成功也可能失败。")]),e._v(" "),n("p",[e._v("操作完成以后，触发success事件或error事件，这时可以通过result属性和error属性拿到操作结果。如果在pending阶段，就去读取这两个属性，是会报错的。")]),e._v(" "),n("p",[e._v("IDBRequest 对象有以下属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBRequest.readyState")]),e._v("：等于pending表示操作正在进行，等于done表示操作正在完成。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBRequest.result")]),e._v("：返回请求的结果。如果请求失败、结果不可用，读取该属性会报错。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBRequest.error")]),e._v("：请求失败时，返回错误对象。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBRequest.source")]),e._v("：返回请求的来源（比如索引对象或 ObjectStore）。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBRequest.transaction")]),e._v("：返回当前请求正在进行的事务，如果不包含事务，返回null。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBRequest.onsuccess")]),e._v("：指定success事件的监听函数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBRequest.onerror")]),e._v("：指定error事件的监听函数。")])])]),e._v(" "),n("p",[e._v("IDBOpenDBRequest 对象继承了 IDBRequest 对象，提供了两个额外的事件监听属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBOpenDBRequest.onblocked")]),e._v("：指定blocked事件（upgradeneeded事件触发时，数据库仍然在使用）的监听函数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBOpenDBRequest.onupgradeneeded")]),e._v("：upgradeneeded事件的监听函数。")])])]),e._v(" "),n("h2",{attrs:{id:"idbdatabase-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#idbdatabase-对象"}},[e._v("#")]),e._v(" IDBDatabase 对象")]),e._v(" "),n("p",[e._v("打开数据成功以后，可以从IDBOpenDBRequest对象的result属性上面，拿到一个IDBDatabase对象，它表示连接的数据库。后面对数据库的操作，都通过这个对象完成。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var db;\nvar DBOpenRequest = window.indexedDB.open('demo', 1);\n\nDBOpenRequest.onerror = function (event) {\n  console.log('Error');\n};\n\nDBOpenRequest.onsuccess = function(event) {\n  db = DBOpenRequest.result;\n  // ...\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h3",{attrs:{id:"_1-属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-属性"}},[e._v("#")]),e._v(" 1. 属性")]),e._v(" "),n("p",[e._v("IDBDatabase 对象有以下属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBDatabase.name")]),e._v("：字符串，数据库名称。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.version")]),e._v("：整数，数据库版本。数据库第一次创建时，该属性为空字符串。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.objectStoreNames")]),e._v("：DOMStringList 对象（字符串的集合），包含当前数据的所有 object store 的名字。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.onabort")]),e._v("：指定 abort 事件（事务中止）的监听函数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.onclose")]),e._v("：指定 close 事件（数据库意外关闭）的监听函数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.onerror")]),e._v("：指定 error 事件（访问数据库失败）的监听函数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.onversionchange")]),e._v("：数据库版本变化时触发（发生upgradeneeded事件，或调用indexedDB.deleteDatabase()）。")])])]),e._v(" "),n("p",[e._v("下面是objectStoreNames属性的例子。该属性返回一个 DOMStringList 对象，包含了当前数据库所有对象仓库的名称（即表名），可以使用 DOMStringList 对象的contains方法，检查数据库是否包含某个对象仓库。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("if (!db.objectStoreNames.contains('firstOS')) {\n  db.createObjectStore('firstOS');\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("上面代码先判断某个对象仓库是否存在，如果不存在就创建该对象仓库。")]),e._v(" "),n("h3",{attrs:{id:"_2-方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-方法"}},[e._v("#")]),e._v(" 2.方法")]),e._v(" "),n("p",[e._v("IDBDatabase 对象有以下方法。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBDatabase.close()")]),e._v("：关闭数据库连接，实际会等所有事务完成后再关闭。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.createObjectStore()")]),e._v("：创建存放数据的对象仓库，类似于传统关系型数据库的表格，返回一个 IDBObjectStore 对象。该方法只能在versionchange事件监听函数中调用。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.deleteObjectStore()")]),e._v("：删除指定的对象仓库。该方法只能在versionchange事件监听函数中调用。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBDatabase.transaction()")]),e._v("：返回一个 IDBTransaction 事务对象。")])])]),e._v(" "),n("p",[e._v("下面是createObjectStore()方法的例子。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var request = window.indexedDB.open('demo', 2);\n\nrequest.onupgradeneeded = function (event) {\n  var db = event.target.result;\n\n  db.onerror = function(event) {\n    console.log('error');\n  };\n\n  var objectStore = db.createObjectStore('items');\n\n  // ...\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("p",[e._v("上面代码创建了一个名为items的对象仓库，如果该对象仓库已经存在，就会抛出一个错误。为了避免出错，需要用到下文的objectStoreNames属性，检查已有哪些对象仓库。")]),e._v(" "),n("p",[e._v("createObjectStore()方法还可以接受第二个对象参数，用来设置对象仓库的属性。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("db.createObjectStore('test', { keyPath: 'email' });\ndb.createObjectStore('test2', { autoIncrement: true });\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("上面代码中，keyPath属性表示主键（由于主键的值不能重复，所以上例存入之前，必须保证数据的email属性值都是不一样的），默认值为null；autoIncrement属性表示，是否使用自动递增的整数作为主键（第一个数据记录为1，第二个数据记录为2，以此类推），默认为false。一般来说，keyPath和autoIncrement属性只要使用一个就够了，如果两个同时使用，表示主键为递增的整数，且对象不得缺少keyPath指定的属性。")]),e._v(" "),n("p",[e._v("下面是deleteObjectStore()方法的例子。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var dbName = 'sampleDB';\nvar dbVersion = 2;\nvar request = indexedDB.open(dbName, dbVersion);\n\nrequest.onupgradeneeded = function(e) {\n  var db = request.result;\n  if (e.oldVersion < 1) {\n    db.createObjectStore('store1');\n  }\n\n  if (e.oldVersion < 2) {\n    db.deleteObjectStore('store1');\n    db.createObjectStore('store2');\n  }\n\n  // ...\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br")])]),n("p",[e._v("下面是transaction()方法的例子，该方法用于创建一个数据库事务，返回一个 IDBTransaction 对象。向数据库添加数据之前，必须先创建数据库事务。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var t = db.transaction(['items'], 'readwrite');\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("transaction()方法接受两个参数：第一个参数是一个数组，里面是所涉及的对象仓库，通常是只有一个；第二个参数是一个表示操作类型的字符串。目前，操作类型只有两种：readonly（只读）和readwrite（读写）。添加数据使用readwrite，读取数据使用readonly。第二个参数是可选的，省略时默认为readonly模式。")]),e._v(" "),n("h2",{attrs:{id:"idbobjectstore-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#idbobjectstore-对象"}},[e._v("#")]),e._v(" IDBObjectStore 对象")]),e._v(" "),n("p",[e._v("IDBObjectStore 对象对应一个对象仓库（object store）。IDBDatabase.createObjectStore()方法返回的就是一个 IDBObjectStore 对象。")]),e._v(" "),n("p",[e._v("IDBDatabase 对象的transaction()返回一个事务对象，该对象的objectStore()方法返回 IDBObjectStore 对象，因此可以采用下面的链式写法。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("db.transaction(['test'], 'readonly')\n  .objectStore('test')\n  .get(X)\n  .onsuccess = function (e) {}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h3",{attrs:{id:"_1-属性-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-属性-2"}},[e._v("#")]),e._v(" 1.  属性")]),e._v(" "),n("p",[e._v("IDBObjectStore 对象有以下属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBObjectStore.indexNames")]),e._v("：返回一个类似数组的对象（DOMStringList），包含了当前对象仓库的所有索引。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBObjectStore.keyPath")]),e._v("：返回当前对象仓库的主键。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBObjectStore.name")]),e._v("：返回当前对象仓库的名称。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBObjectStore.transaction")]),e._v("：返回当前对象仓库所属的事务对象。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBObjectStore.autoIncrement")]),e._v("：布尔值，表示主键是否会自动递增。")])])]),e._v(" "),n("h3",{attrs:{id:"_2-方法-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-方法-2"}},[e._v("#")]),e._v(" 2. 方法")]),e._v(" "),n("p",[e._v("IDBObjectStore 对象有以下方法。")]),e._v(" "),n("h4",{attrs:{id:"_1-idbobjectstore-add"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-idbobjectstore-add"}},[e._v("#")]),e._v(" （1）IDBObjectStore.add()")]),e._v(" "),n("p",[e._v("IDBObjectStore.add()用于向对象仓库添加数据，返回一个 IDBRequest 对象。该方法只用于添加数据，如果主键相同会报错，因此更新数据必须使用put()方法。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.add(value, key)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("该方法接受两个参数，第一个参数是键值，第二个参数是主键，该参数可选，如果省略默认为null。")]),e._v(" "),n("p",[e._v("创建事务以后，就可以获取对象仓库，然后使用add()方法往里面添加数据了。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var db;\nvar DBOpenRequest = window.indexedDB.open('demo', 1);\n\nDBOpenRequest.onsuccess = function (event) {\n  db = DBOpenRequest.result;\n  var transaction = db.transaction(['items'], 'readwrite');\n\n  transaction.oncomplete = function (event) {\n    console.log('transaction success');\n  };\n\n  transaction.onerror = function (event) {\n    console.log('transaction error: ' + transaction.error);\n  };\n\n  var objectStore = transaction.objectStore('items');\n  var objectStoreRequest = objectStore.add({ foo: 1 });\n\n  objectStoreRequest.onsuccess = function (event) {\n    console.log('add data success');\n  };\n\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br")])]),n("h4",{attrs:{id:"_2-idbobjectstore-put"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-idbobjectstore-put"}},[e._v("#")]),e._v(" （2）IDBObjectStore.put()")]),e._v(" "),n("p",[e._v("IDBObjectStore.put()方法用于更新某个主键对应的数据记录，如果对应的键值不存在，则插入一条新的记录。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.put(item, key)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("该方法接受两个参数，第一个参数为新数据，第二个参数为主键，该参数可选，且只在自动递增时才有必要提供，因为那时主键不包含在数据值里面。")]),e._v(" "),n("h4",{attrs:{id:"_3-idbobjectstore-clear"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-idbobjectstore-clear"}},[e._v("#")]),e._v(" （3）IDBObjectStore.clear()")]),e._v(" "),n("p",[e._v("IDBObjectStore.clear()删除当前对象仓库的所有记录。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.clear()\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("该方法不需要参数。")]),e._v(" "),n("h4",{attrs:{id:"_4-idbobjectstore-delete"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-idbobjectstore-delete"}},[e._v("#")]),e._v(" （4）IDBObjectStore.delete()")]),e._v(" "),n("p",[e._v("IDBObjectStore.delete()方法用于删除指定主键的记录。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.delete(Key)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("该方法的参数为主键的值。")]),e._v(" "),n("h4",{attrs:{id:"_5-idbobjectstore-count"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-idbobjectstore-count"}},[e._v("#")]),e._v(" （5）IDBObjectStore.count()")]),e._v(" "),n("p",[e._v("IDBObjectStore.count()方法用于计算记录的数量。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("IDBObjectStore.count(key)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("不带参数时，该方法返回当前对象仓库的所有记录数量。如果主键或 IDBKeyRange 对象作为参数，则返回对应的记录数量。")]),e._v(" "),n("h4",{attrs:{id:"_6-idbobjectstore-getkey"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-idbobjectstore-getkey"}},[e._v("#")]),e._v(" （6）IDBObjectStore.getKey()")]),e._v(" "),n("p",[e._v("IDBObjectStore.getKey()用于获取主键。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.getKey(key)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("该方法的参数可以是主键值或 IDBKeyRange 对象。")]),e._v(" "),n("h4",{attrs:{id:"_7-idbobjectstore-get"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-idbobjectstore-get"}},[e._v("#")]),e._v(" （7）IDBObjectStore.get()")]),e._v(" "),n("p",[e._v("IDBObjectStore.get()用于获取主键对应的数据记录。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.get(key)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("h4",{attrs:{id:"_8-idbobjectstore-getall"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-idbobjectstore-getall"}},[e._v("#")]),e._v(" （8）IDBObjectStore.getAll()")]),e._v(" "),n("p",[e._v("DBObjectStore.getAll()用于获取对象仓库的记录。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// 获取所有记录\nobjectStore.getAll()\n\n// 获取所有符合指定主键或 IDBKeyRange 的记录\nobjectStore.getAll(query)\n\n// 指定获取记录的数量\nobjectStore.getAll(query, count)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br")])]),n("h4",{attrs:{id:"_9-idbobjectstore-getallkeys"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-idbobjectstore-getallkeys"}},[e._v("#")]),e._v(" （9）IDBObjectStore.getAllKeys()")]),e._v(" "),n("p",[e._v("IDBObjectStore.getAllKeys()用于获取所有符合条件的主键。该方法返回一个 IDBRequest 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// 获取所有记录的主键\nobjectStore.getAllKeys()\n\n// 获取所有符合条件的主键\nobjectStore.getAllKeys(query)\n\n// 指定获取主键的数量\nobjectStore.getAllKeys(query, count)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br")])]),n("h4",{attrs:{id:"_10-idbobjectstore-index"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-idbobjectstore-index"}},[e._v("#")]),e._v(" （10）IDBObjectStore.index()")]),e._v(" "),n("p",[e._v("IDBObjectStore.index()方法返回指定名称的索引对象 IDBIndex。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.index(name)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("有了索引以后，就可以针对索引所在的属性读取数据。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var t = db.transaction(['people'], 'readonly');\nvar store = t.objectStore('people');\nvar index = store.index('name');\n\nvar request = index.get('foo');\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("上面代码打开对象仓库以后，先用index()方法指定获取name属性的索引，然后用get()方法读取某个name属性(foo)对应的数据。如果name属性不是对应唯一值，这时get()方法有可能取回多个数据对象。另外，get()是异步方法，读取成功以后，只能在success事件的监听函数中处理数据。")]),e._v(" "),n("h4",{attrs:{id:"_11-idbobjectstore-createindex"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-idbobjectstore-createindex"}},[e._v("#")]),e._v(" （11）IDBObjectStore.createIndex()")]),e._v(" "),n("p",[e._v("IDBObjectStore.createIndex()方法用于新建当前数据库的一个索引。该方法只能在VersionChange监听函数里面调用。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.createIndex(indexName, keyPath, objectParameters)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("该方法可以接受三个参数。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("indexName")]),e._v("：索引名")]),e._v(" "),n("li",[n("code",[e._v("keyPath")]),e._v("：主键")]),e._v(" "),n("li",[n("code",[e._v("objectParameters")]),e._v("：配置对象（可选）")])]),e._v(" "),n("p",[e._v("第三个参数可以配置以下属性。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("unique")]),e._v("：如果设为true，将不允许重复的值")]),e._v(" "),n("li",[n("code",[e._v("multiEntry")]),e._v("：如果设为true，对于有多个值的主键数组，每个值将在索引里面新建一个条目，否则主键数组对应一个条目。")])]),e._v(" "),n("p",[e._v("假定对象仓库中的数据记录都是如下的person类型。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var person = {\n  name: name,\n  email: email,\n  created: new Date()\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("可以指定这个对象的某个属性来建立索引。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var store = db.createObjectStore('people', { autoIncrement: true });\n\nstore.createIndex('name', 'name', { unique: false });\nstore.createIndex('email', 'email', { unique: true });\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("上面代码告诉索引对象，name属性不是唯一值，email属性是唯一值。")]),e._v(" "),n("h4",{attrs:{id:"_12-idbobjectstore-deleteindex"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-idbobjectstore-deleteindex"}},[e._v("#")]),e._v(" （12）IDBObjectStore.deleteIndex()")]),e._v(" "),n("p",[e._v("IDBObjectStore.deleteIndex()方法用于删除指定的索引。该方法只能在VersionChange监听函数里面调用。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("objectStore.deleteIndex(indexName)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("h4",{attrs:{id:"_13-idbobjectstore-opencursor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-idbobjectstore-opencursor"}},[e._v("#")]),e._v(" （13）IDBObjectStore.openCursor()")]),e._v(" "),n("p",[e._v("IDBObjectStore.openCursor()用于获取一个指针对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("IDBObjectStore.openCursor()\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("指针对象可以用来遍历数据。该对象也是异步的，有自己的success和error事件，可以对它们指定监听函数。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var t = db.transaction(['test'], 'readonly');\nvar store = t.objectStore('test');\n\nvar cursor = store.openCursor();\n\ncursor.onsuccess = function (event) {\n  var res = event.target.result;\n  if (res) {\n    console.log('Key', res.key);\n    console.dir('Data', res.value);\n    res.continue();\n  }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("p",[e._v("监听函数接受一个事件对象作为参数，该对象的target.result属性指向当前数据记录。该记录的key和value分别返回主键和键值（即实际存入的数据）。continue()方法将光标移到下一个数据对象，如果当前数据对象已经是最后一个数据了，则光标指向null。")]),e._v(" "),n("p",[e._v("openCursor()方法的第一个参数是主键值，或者一个 IDBKeyRange 对象。如果指定该参数，将只处理包含指定主键的记录；如果省略，将处理所有的记录。该方法还可以接受第二个参数，表示遍历方向，默认值为next，其他可能的值为prev、nextunique和prevunique。后两个值表示如果遇到重复值，会自动跳过。")]),e._v(" "),n("h4",{attrs:{id:"_14-idbobjectstore-openkeycursor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-idbobjectstore-openkeycursor"}},[e._v("#")]),e._v(" （14）IDBObjectStore.openKeyCursor()")]),e._v(" "),n("p",[e._v("IDBObjectStore.openKeyCursor()用于获取一个主键指针对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("IDBObjectStore.openKeyCursor()\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("h2",{attrs:{id:"idbtransaction-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#idbtransaction-对象"}},[e._v("#")]),e._v(" IDBTransaction 对象")]),e._v(" "),n("p",[e._v("IDBTransaction 对象用来异步操作数据库事务，所有的读写操作都要通过这个对象进行。")]),e._v(" "),n("p",[e._v("IDBDatabase.transaction()方法返回的就是一个 IDBTransaction 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var db;\nvar DBOpenRequest = window.indexedDB.open('demo', 1);\n\nDBOpenRequest.onsuccess = function(event) {\n  db = DBOpenRequest.result;\n  var transaction = db.transaction(['demo'], 'readwrite');\n\n  transaction.oncomplete = function (event) {\n    console.log('transaction success');\n  };\n\n  transaction.onerror = function (event) {\n    console.log('transaction error: ' + transaction.error);\n  };\n\n  var objectStore = transaction.objectStore('demo');\n  var objectStoreRequest = objectStore.add({ foo: 1 });\n\n  objectStoreRequest.onsuccess = function (event) {\n    console.log('add data success');\n  };\n\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br")])]),n("p",[e._v("事务的执行顺序是按照创建的顺序，而不是发出请求的顺序。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var trans1 = db.transaction('foo', 'readwrite');\nvar trans2 = db.transaction('foo', 'readwrite');\nvar objectStore2 = trans2.objectStore('foo')\nvar objectStore1 = trans1.objectStore('foo')\nobjectStore2.put('2', 'key');\nobjectStore1.put('1', 'key');\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("上面代码中，key对应的键值最终是2，而不是1。因为事务trans1先于trans2创建，所以首先执行。")]),e._v(" "),n("p",[e._v("注意，事务有可能失败，只有监听到事务的complete事件，才能保证事务操作成功。")]),e._v(" "),n("p",[e._v("IDBTransaction 对象有以下属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBTransaction.db")]),e._v("：返回当前事务所在的数据库对象 IDBDatabase。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBTransaction.error")]),e._v("：返回当前事务的错误。如果事务没有结束，或者事务成功结束，或者被手动终止，该方法返回null。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBTransaction.mode")]),e._v("：返回当前事务的模式，默认是readonly（只读），另一个值是readwrite。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBTransaction.objectStoreNames")]),e._v("：返回一个类似数组的对象 DOMStringList，成员是当前事务涉及的对象仓库的名字。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBTransaction.onabort")]),e._v("：指定abort事件（事务中断）的监听函数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBTransaction.oncomplete")]),e._v("：指定complete事件（事务成功）的监听函数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBTransaction.onerror")]),e._v("：指定error事件（事务失败）的监听函数。")])])]),e._v(" "),n("p",[e._v("IDBTransaction 对象有以下方法。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBTransaction.abort()")]),e._v("：终止当前事务，回滚所有已经进行的变更。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBTransaction.objectStore(name)")]),e._v("：返回指定名称的对象仓库 IDBObjectStore。")])])]),e._v(" "),n("h2",{attrs:{id:"idbindex-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#idbindex-对象"}},[e._v("#")]),e._v(" IDBIndex 对象")]),e._v(" "),n("p",[e._v("IDBIndex 对象代表数据库的索引，通过这个对象可以获取数据库里面的记录。数据记录的主键默认就是带有索引，IDBIndex 对象主要用于通过除主键以外的其他键，建立索引获取对象。")]),e._v(" "),n("p",[e._v("IDBIndex 是持久性的键值对存储。只要插入、更新或删除数据记录，引用的对象库中的记录，索引就会自动更新。")]),e._v(" "),n("p",[e._v("IDBObjectStore.index()方法可以获取 IDBIndex 对象。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var transaction = db.transaction(['contactsList'], 'readonly');\nvar objectStore = transaction.objectStore('contactsList');\nvar myIndex = objectStore.index('lName');\n\nmyIndex.openCursor().onsuccess = function (event) {\n  var cursor = event.target.result;\n  if (cursor) {\n    var tableRow = document.createElement('tr');\n    tableRow.innerHTML =   '<td>' + cursor.value.id + '</td>'\n                         + '<td>' + cursor.value.lName + '</td>'\n                         + '<td>' + cursor.value.fName + '</td>'\n                         + '<td>' + cursor.value.jTitle + '</td>'\n                         + '<td>' + cursor.value.company + '</td>'\n                         + '<td>' + cursor.value.eMail + '</td>'\n                         + '<td>' + cursor.value.phone + '</td>'\n                         + '<td>' + cursor.value.age + '</td>';\n    tableEntry.appendChild(tableRow);\n\n    cursor.continue();\n  } else {\n    console.log('Entries all displayed.');\n  }\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br")])]),n("p",[e._v("IDBIndex 对象有以下属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBIndex.name")]),e._v("：字符串，索引的名称。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.objectStore")]),e._v("：索引所在的对象仓库。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.keyPath")]),e._v("：索引的主键。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.multiEntry")]),e._v("：布尔值，针对keyPath为数组的情况，如果设为true，创建数组时，每个数组成员都会有一个条目，否则每个数组都只有一个条目。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.unique")]),e._v("：布尔值，表示创建索引时是否允许相同的主键。\nIDBIndex 对象有以下方法，它们都是异步的，立即返回的都是一个 IDBRequest 对象。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.count()")]),e._v("：用来获取记录的数量。它可以接受主键或 IDBKeyRange 对象作为参数，这时只返回符合主键的记录数量，否则返回所有记录的数量。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.get(key)")]),e._v("：用来获取符合指定主键的数据记录。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.getKey(key)")]),e._v("：用来获取指定的主键。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.getAll()")]),e._v("：用来获取所有的数据记录。它可以接受两个参数，都是可选的，第一个参数用来指定主键，第二个参数用来指定返回记录的数量。如果省略这两个参数，则返回所有记录。由于获取成功时，浏览器必须生成所有对象，所以对性能有影响。如果数据集比较大，建议使用\nIDBCursor 对象。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.getAllKeys()")]),e._v("：该方法与IDBIndex.getAll()方法相似，区别是获取所有主键。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.openCursor()")]),e._v("：用来获取一个 IDBCursor 对象，用来遍历索引里面的所有条目。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBIndex.openKeyCursor()")]),e._v("：该方法与IDBIndex.openCursor()方法相似，区别是遍历所有条目的主键。")])])]),e._v(" "),n("h2",{attrs:{id:"idbcursor-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#idbcursor-对象"}},[e._v("#")]),e._v(" IDBCursor 对象")]),e._v(" "),n("p",[e._v("IDBCursor 对象代表指针对象，用来遍历数据仓库（IDBObjectStore）或索引（IDBIndex）的记录。")]),e._v(" "),n("p",[e._v("IDBCursor 对象一般通过IDBObjectStore.openCursor()方法获得。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var transaction = db.transaction(['rushAlbumList'], 'readonly');\nvar objectStore = transaction.objectStore('rushAlbumList');\n\nobjectStore.openCursor(null, 'next').onsuccess = function(event) {\n  var cursor = event.target.result;\n  if (cursor) {\n    var listItem = document.createElement('li');\n      listItem.innerHTML = cursor.value.albumTitle + ', ' + cursor.value.year;\n      list.appendChild(listItem);\n\n      console.log(cursor.source);\n      cursor.continue();\n    } else {\n      console.log('Entries all displayed.');\n    }\n  };\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br")])]),n("p",[e._v("IDBCursor 对象的属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBCursor.source")]),e._v("：返回正在遍历的对象仓库或索引。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.direction")]),e._v("：字符串，表示指针遍历的方向。共有四个可能的值：next（从头开始向后遍历）、nextunique（从头开始向后遍历，重复的值只遍历一次）、prev（从尾部开始向前遍历）、prevunique（从尾部开始向前遍历，重复的值只遍历一次）。该属性通过IDBObjectStore.openCursor()方法的第二个参数指定，一旦指定就不能改变了。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.key")]),e._v("：返回当前记录的主键。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.value")]),e._v("：返回当前记录的数据值。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.primaryKey")]),e._v("：返回当前记录的主键。对于数据仓库（objectStore）来说，这个属性等同于 IDBCursor.key；对于索引，\nIDBCursor.key 返回索引的位置值，该属性返回数据记录的主键。")])])]),e._v(" "),n("p",[e._v("IDBCursor 对象有如下方法。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBCursor.advance(n)")]),e._v("：指针向前移动 n 个位置。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.continue()")]),e._v("：指针向前移动一个位置。它可以接受一个主键作为参数，这时会跳转到这个主键。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.continuePrimaryKey()")]),e._v("：该方法需要两个参数，第一个是key，第二个是primaryKey，将指针移到符合这两个参数的位置。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.delete()")]),e._v("：用来删除当前位置的记录，返回一个 IDBRequest 对象。该方法不会改变指针的位置。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBCursor.update()")]),e._v("：用来更新当前位置的记录，返回一个 IDBRequest 对象。它的参数是要写入数据库的新的值。")])])]),e._v(" "),n("h2",{attrs:{id:"idbkeyrange-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#idbkeyrange-对象"}},[e._v("#")]),e._v(" IDBKeyRange 对象")]),e._v(" "),n("p",[e._v("IDBKeyRange 对象代表数据仓库（object store）里面的一组主键。根据这组主键，可以获取数据仓库或索引里面的一组记录。")]),e._v(" "),n("p",[e._v("IDBKeyRange 可以只包含一个值，也可以指定上限和下限。它有四个静态方法，用来指定主键的范围。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBKeyRange.lowerBound()")]),e._v("：指定下限。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBKeyRange.upperBound()")]),e._v("：指定上限。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBKeyRange.bound()")]),e._v("：同时指定上下限。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBKeyRange.only()")]),e._v("：指定只包含一个值。")])])]),e._v(" "),n("p",[e._v("下面是一些代码实例。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// All keys ≤ x\nvar r1 = IDBKeyRange.upperBound(x);\n\n// All keys < x\nvar r2 = IDBKeyRange.upperBound(x, true);\n\n// All keys ≥ y\nvar r3 = IDBKeyRange.lowerBound(y);\n\n// All keys > y\nvar r4 = IDBKeyRange.lowerBound(y, true);\n\n// All keys ≥ x && ≤ y\nvar r5 = IDBKeyRange.bound(x, y);\n\n// All keys > x &&< y\nvar r6 = IDBKeyRange.bound(x, y, true, true);\n\n// All keys > x && ≤ y\nvar r7 = IDBKeyRange.bound(x, y, true, false);\n\n// All keys ≥ x &&< y\nvar r8 = IDBKeyRange.bound(x, y, false, true);\n\n// The key = z\nvar r9 = IDBKeyRange.only(z);\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br")])]),n("p",[e._v("IDBKeyRange.lowerBound()、IDBKeyRange.upperBound()、IDBKeyRange.bound()这三个方法默认包括端点值，可以传入一个布尔值，修改这个属性。")]),e._v(" "),n("p",[e._v("与之对应，IDBKeyRange 对象有四个只读属性。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("IDBKeyRange.lower")]),e._v("：返回下限")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBKeyRange.lowerOpen")]),e._v("：布尔值，表示下限是否为开区间（即下限是否排除在范围之外）")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBKeyRange.upper")]),e._v("：返回上限")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("IDBKeyRange.upperOpen")]),e._v("：布尔值，表示上限是否为开区间（即上限是否排除在范围之外）")])])]),e._v(" "),n("p",[e._v("IDBKeyRange 实例对象生成以后，将它作为参数输入 IDBObjectStore 或 IDBIndex 对象的openCursor()方法，就可以在所设定的范围内读取数据。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var t = db.transaction(['people'], 'readonly');\nvar store = t.objectStore('people');\nvar index = store.index('name');\n\nvar range = IDBKeyRange.bound('B', 'D');\n\nindex.openCursor(range).onsuccess = function (e) {\n  var cursor = e.target.result;\n  if (cursor) {\n    console.log(cursor.key + ':');\n\n    for (var field in cursor.value) {\n      console.log(cursor.value[field]);\n    }\n    cursor.continue();\n  }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br")])]),n("p",[e._v("IDBKeyRange 有一个实例方法includes(key)，返回一个布尔值，表示某个主键是否包含在当前这个主键组之内。")]),e._v(" "),n("div",{staticClass:"language-indexDB line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var keyRangeValue = IDBKeyRange.bound('A', 'K', false, false);\n\nkeyRangeValue.includes('F') // true\nkeyRangeValue.includes('W') // false\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);